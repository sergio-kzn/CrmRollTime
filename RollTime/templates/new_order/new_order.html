{% extends "new_order/base.html" %} {% block script_in_head %}{% endblock %} {% block container %}
<form method="post" action="" id="form_new_order_data">
    {% csrf_token %}
    <div class="container-xl">
        <div class="row  no-gutters">

            <!-- Блок Новый заказ - слева -->
            <div class="col-5 col-md-5">
                <!-- Вкладки -->
                <ul class="nav nav-tabs mt-2" id="new-order-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#order">Заказ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#details">Детали</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#advanced">Отметки</a>
                    </li>
                </ul>

                <!-- Содержимое вкладок (левая колонка) -->
                <div class="tab-content mt-3">
                    <!-- Первый блок - Заказ (он отображается по умолчанию, т.к. имеет классы show и active) -->
                    <div class="tab-pane fade table-responsive active show mr-3" id="order">
                        <table class="table input_to_text">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">Наим-е</th>
                                    <th scope="col">Кол-во</th>
                                    <th scope="col">Цена</th>
                                    <th scope="col">Сумма</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{ formset.management_form }} {% for form in formset %}
                                <tr id="row_id_{{ forloop.counter0 }}">
                                    <th>{{ form.order_item_item_id }}</th>
                                    <td>{{ form.order_item_quantity }} {% if formset.can_delete %}
                                        <span class="d-none">{{ form.DELETE }}</span> {% endif %}
                                    </td>
                                    <td>{{ form.order_item_price }}</td>
                                    <td></td>
                                </tr>
                                {% endfor %}


                            </tbody>
                        </table>

                        <div id="empty_form" style="display:none">
                            <table>
                                <tbody>
                                    {{ formset.empty_form }}
                            </table>
                        </div>
                    </div>

                    <!-- Второй блок - Детали -->
                    <div class="tab-pane mr-3 fade" id="details">

                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="width:180px">Филиал / Точка</span>
                            </div>
                            {{ form.order_branch }}
                        </div>

                        <div class="input-group mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="width:180px">Телефон</span>
                            </div>
                            {{ form.order_client_phone }}
                        </div>

                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="width:180px">Имя</span>
                            </div>
                            {{ form.order_client_name }}
                        </div>
                        <div class="input-group mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="width:180px">Улица</span>
                            </div>
                            {{ form.order_delivery_street }}
                        </div>
                        <div class="input-group mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="width:180px">Дом</span>
                            </div>
                            {{ form.order_delivery_house }}
                        </div>
                        <div class="input-group mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="width:180px">Подъезд</span>
                            </div>
                            {{ form.order_delivery_entrance }}
                        </div>
                        <div class="input-group mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="width:180px">Этаж</span>
                            </div>
                            {{ form.order_delivery_floor }}
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="width:180px">Кв. (офис)</span>
                            </div>
                            {{ form.order_delivery_flat }}
                        </div>
                        <div class="input-group mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="width:180px">Примечание</span>
                            </div>
                            {{ form.order_comment }}
                        </div>
                    </div>

                    <!-- Третий блок - Отметки -->
                    <div class="tab-pane mr-3 fade" id="advanced">
                        <!-- {{ form.errors }}-->
                        <div class="input-group mb-3 ">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="width:180px">Предзаказ</span>
                            </div>
                            <div class="custom-file custom-calendar" style="min-width:190px">
                                {{ form.order_date_time }}
                                <!--suppress XmlInvalidId -->
                                <label class="input-group-text" for="data-timepicker"></label>
                            </div>
                            <div class="input-group-append">
                                <span class="input-group-text">
                                    <i class="far fa-question-circle ml-1 mr-1" data-toggle="tooltip" title="Позволяет создавать заказ на определенную дату.
Предзаказ отображается как обычный заказ на дату предзаказа."></i></span>
                            </div>
                        </div>

                        <div class="input-group mb-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text" style="width:180px">Сертификат</span>
                            </div>
                            {{ form.order_certificate }}

                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button">Найти</button>
                                <span class="input-group-text"><i class="far fa-question-circle ml-1 mr-1"
                                        data-toggle="tooltip" title="С помощью сертификата можно
                        добавлять в заказ подарки или товары с заданной ценой. Сертификаты создаются
                        в соответствующем справочнике."></i></span>
                            </div>
                        </div>


                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" style="width:180px">Узнали
                                    из</label>
                            </div>
                            {{ form.order_learning_from }}
                        </div>

                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <label class="input-group-text" style="width:180px">Оплата</label>
                            </div>
                            {{ form.order_payment }}
                        </div>

                        <div class="btn-group btn-group-toggle btn-block" data-toggle="buttons">
                            {% for mark in form.order_marks %}
                            <label class="btn
                                {% if mark.choice_label == 'x' %}
                                btn-outline-secondary col-1 active
                                {% else %}
                                btn-outline-primary
                                {% endif %}">
                                {{ mark.tag }}{{ mark.choice_label }}
                            </label> {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Блок с категориями - по центру -->
            <div class="col-2 col-md-2 bg-light custom-nav overflow-auto">
                <ul class="nav nav-tabs mt-2 mb-1 flex-column">
                    {% for category in category_list %} {% if category.category_show %}
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#id_{{ category.category_id}}">
                            {{ category.category_name }}</a></li>
                    {% endif %} {% endfor %}
                </ul>
            </div>

            <!-- Блок с товарам - справа -->
            <div class="col-5 coll-md-5 overflow-auto">
                <div class="tab-content custom-list mt-2">
                    <!-- FIXME: добавить класс active и show к первому div id -->
                    {% for category in category_list %} {% if category.category_show %}
                    <div class="tab-pane fade" id="id_{{ category.category_id}}">
                        <div class="list-group">
                            {% for item in item_list %} {% if item.item_category_id == category.category_id %} {% if item.item_show %}
                            <a href="javascript://" onclick="addRow('{{ item.item_id }}', '{{ item.item_name }}', '{{ item.item_price }}'); return false;" class="list-group-item list-group-item-action">
                                {{ item.item_name }} <span>{{ item.item_price }} руб.</span>
                            </a> {% endif %} {% endif %} {% endfor %}
                        </div>
                    </div>
                    {% endif %} {% endfor %}
                </div>
            </div>
        </div>


    </div>

    <!-- Нижний блок -->
    <footer class="footer">
        <div class="container-xl">
            <div class="row  align-items-center pt-3 pb-3">
                <div class="col mt-1">
                    <div class="input-group" style="width:150px">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Приборы</span>
                        </div>
                        {{ form.order_person }}
                    </div>
                </div>
                <div class="col mt-1">
                    <div class="input-group" style="width:150px">
                        {{ form.order_sale }}
                    </div>
                </div>

                <div class="col mt-1">
                    <div class="input-group" style="min-width:175px">
                        <span class="alert alert-success mb-0">К оплате <span id="total_price">0</span> руб.</span>
                    </div>
                </div>

                <div class="col mt-1">
                    <div class="input-group" style="min-width:170px">

                        <div class="input-group-prepend">
                            <button class="btn btn-success" type="submit"><i class="fas fa-cart-plus"></i> Сохранить
                            </button>
                        </div>
                        <div class="input-group-append" id="button-addon4">
                            <button class="btn btn-danger" type="button"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</form>
{% endblock %} {% block scripts %}
<script>
    function setHeiHeight() {
        var footerHeight = document.querySelector('footer').offsetHeight;
        var navBarHeight = document.querySelector('nav').offsetHeight;
        var tabsHeight = document.querySelector('#new-order-tabs').offsetHeight

        $('#order').css({
            height: $(window).height() - footerHeight - navBarHeight - tabsHeight - 23 + 'px'
        });
    }
    setHeiHeight(); // устанавливаем высоту окна при первой загрузке страницы
    $(window).resize(setHeiHeight); // обновляем при изменении размеров окна
</script>
{% endblock %}